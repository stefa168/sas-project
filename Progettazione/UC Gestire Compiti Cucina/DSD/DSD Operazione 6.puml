@startuml Operazione 6
skinparam Style strictuml

collections UI

participant "taskManager: KitchenTaskManager" as tm
UI -> tm: createKitchenJob(task, turn, amount, estimatedDuration)
activate tm

participant "task: Task" as task
participant "ktr: KitchenTaskReceiver" as ktr

alt currentSheet == null || Date.now() > turn.endDate || turn.complete
    UI <<-- tm: throw UseCaseLogicException
else task.amount < 0 || task.estimatedDuration < 0
    UI <<-- tm: throw TaskException
else

    tm -> task: addKitchenKitchenJob(turn, amount, estimatedDuration)
    activate task

    participant "job: KitchenJob" as job
    task -->> job**: create(turn, amount, estimatedDuration)

    activate job
        job -> job: this.amount = amount
        job -> job: this.duration = estimatedDuration
        job -> job: this.turn = turn
        job -> job: this.cook = null

    return job

    tm <- task: job
    deactivate task

    |||
    tm -> tm: notifyCreatedKitchenJob(job)
    activate tm
    loop for all ktr in eventReceivers
        tm -> ktr : updateCreatedKitchenJob(job)
        activate ktr
        deactivate ktr
    end
    deactivate tm

    UI <- tm: job
    deactivate tm
    
end

@enduml